---
title: "parkinsonsMetagenomicData"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{parkinsonsMetagenomicData}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(parkinsonsMetagenomicData)
library(dplyr)
library(DT)
```

# Sample Metadata

Metadata for all samples present within `parkinsonsMetagenomicData` is available
through the included `data.frame` `sampleMetadata`. Both curated and uncurated
features are included in this `data.frame`, with uncurated features being
prefixed by "uncurated_". Curated features include the following at this time:

 * curation_id
 * study_name
 * sample_id
 * subject_id
 * target_condition
 * target_condition_ontology_term_id
 * control
 * control_ontology_term_id
 * age
 * age_group
 * age_group_ontology_term_id
 * age_unit
 * age_unit_ontology_term_id
 * sex
 * sex_ontology_term_id
 * disease
 * disease_ontology_term_id
 * curator
 * BioProject
 * BioSample
 * NCBI_accession
 * uuid

```{r, collapse = TRUE}
sampleMetadata |>
    filter(study_name == "BedarfJR_2017") |>
    select(where(~ !any(is.na(.x)))) |>
    slice(1:10) |>
    select(1:10) |>
    datatable(options = list(dom = "t"), extensions = "Responsive")
```

# MetaPhlAn Results

The UUID(s) of any sample(s) of interest may be then used to access MetaPhlAn
output files.

Note: output files are contained in a private Google Cloud Bucket at the moment,
the user must authenticate with a service account keyfile in the following way:

```{r}
gcs_auth("full/path/to/keyfile.json")
```

To access MetaPhlAn output files, use `getMetagenomicData`. This function takes
UUID and data type arguments, downloads the corresponding MetaPhlAn output
files, and stores them in a local cache. If the same files are requested again
through this function, they will not be re-downloaded unless explicitly
specified, in order to reduce excessive downloads. `getMetagenomicData` returns
a tibble of cached file paths and cache IDs for each requested file. The file
paths can be used to read the cached files into R.

```{r}
cache_tbl <- getMetagenomicData(uuid = "004c5d07-ec87-40fe-9a72-6b23d6ec584e",
                                data_type = "all")
datatable(cache_table, options = list(dom = "t"), extensions = "Responsive")
```


