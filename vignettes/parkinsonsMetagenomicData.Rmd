---
title: "parkinsonsMetagenomicData"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{parkinsonsMetagenomicData}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(parkinsonsMetagenomicData)
library(dplyr)
library(DT)
```

# Sample Metadata

Metadata for all samples present within `parkinsonsMetagenomicData` is available
through the included `data.frame` `sampleMetadata`. Both curated and uncurated
features are included in this `data.frame`, with uncurated features being
prefixed by "uncurated_". Curated features include the following at this time:

 * curation_id
 * study_name
 * sample_id
 * subject_id
 * target_condition
 * target_condition_ontology_term_id
 * control
 * control_ontology_term_id
 * age
 * age_group
 * age_group_ontology_term_id
 * age_unit
 * age_unit_ontology_term_id
 * sex
 * sex_ontology_term_id
 * disease
 * disease_ontology_term_id
 * curator
 * BioProject
 * BioSample
 * NCBI_accession
 * uuid

```{r, collapse = TRUE}
sampleMetadata |>
    filter(study_name == "BedarfJR_2017") |>
    select(where(~ !any(is.na(.x)))) |>
    slice(1:10) |>
    select(1:10) |>
    datatable(options = list(dom = "t"), extensions = "Responsive")
```

# MetaPhlAn Results

The UUID(s) of any sample(s) of interest may be then used to access MetaPhlAn
output files.

Note: output files are contained in a private Google Cloud Bucket at the moment,
the user must authenticate with a service account keyfile in the following way:

```{r}
gcs_auth("full/path/to/keyfile.json")
```

To access a particular output file, use `get_metaphlan_locator` to return the
path to the relevant file within the Google Cloud Bucket. Then use
`cache_metaphlan` to download the file and store it in a cache location. If
this operation is performed a second time, the file will not be redownloaded
unless explicity specified, in order to reduce excessive downloads. The cached
file can then be read into R.

```{r}
locator <- get_metaphlan_locator(uuid = "004c5d07-ec87-40fe-9a72-6b23d6ec584e",
                                 data_type = "bugs")
cached_file_path <- cache_metaphlan(locator)
metaphlan_table <- readr::read_tsv(cached_file_path, skip = 4)
```


